pipeline {

  agent any

  stages {

    stage('Checkout Source') {
      steps {
        git url:'https://github.com/lingamnagani/javademo.git', branch:'master'
      }
    }
    stage('Deploy App') {
      steps {
      sshagent(['sampledemo']) 
         sh "scp-o StrictHostKeyChecking=no config.yaml ubuntu@13.233.66.168:/home/ubuntu/"
         script {
          try {
                sh "ssh ubuntu@13.233.66.168 kubectl apply -f config.yaml"
        } catch(error) {
             sh "ssh ubuntu@13.233.66.168 kubectl create -f config.yaml "
}
         }       
      }
   }
}
}
}
